import json
import math

# Coordinates from Step 223
coords = [[434,224],[425.5999450683594,202.8826446533203],[418.9422302246094,181.1501922607422],[413.67669677734375,159.0369110107422],[412.3517761230469,136.94342041015625],[405.5975341796875,117.09466552734375],[383.9463806152344,110.69966125488281],[361.3454895019531,108.25228881835938],[338.9284362792969,104.64510345458984],[316.4202880859375,106.96502685546875],[295.8423767089844,116.40872955322266],[278.8519592285156,131.4075698852539],[266.2750549316406,150.27572631835938],[258.6982727050781,171.64830017089844],[256.81109619140625,194.23585510253906],[261.26670837402344,216.44606018066406],[270.5153045654297,237.11822509765625],[283.5571594238281,255.7361602783203],[293.62646484375,275.98927307128906],[292.85870361328125,298.4052429199219],[280.2685241699219,317.1131896972656],[264.37176513671875,333.3599853515625],[253.00955200195312,352.8233947753906],[250.0211944580078,375.3384094238281],[248.40945434570312,398.01397705078125],[247.6142120361328,420.7336120605469],[247.41680908203125,443.4666442871094],[247.60569763183594,466.2000427246094],[247.98109436035156,488.9313659667969],[248.34642028808594,511.66278076171875],[248.50430297851562,534.3964233398438],[248.25376892089844,557.1289672851562],[248.13174438476562,579.85791015625],[247.57872009277344,602.585205078125],[247.11122131347656,625.3140869140625],[247.7758331298828,648.033447265625],[250.79713439941406,670.5480346679688],[257.838134765625,692.1112060546875],[270.59617614746094,710.8027954101562],[288.8983459472656,724.1070556640625],[285.99200439453125,732.0960083007812],[263.2738800048828,732.4268798828125],[241.39015197753906,737.4060668945312],[228.52528381347656,726.3516845703125],[227.3872528076172,703.6536865234375],[223.7249755859375,681.2642822265625],[220.27870178222656,658.7926635742188],[223.5876922607422,640.5146484375],[238.3990020751953,624.6627807617188],[237.65489196777344,602.1087646484375],[232.2482452392578,580.0300903320312],[227.2136688232422,557.8858032226562],[221.8109893798828,535.8038330078125],[216.83641052246094,513.6203918457031],[211.7307891845703,491.4671325683594],[206.50186157226562,469.3480224609375],[201.89756774902344,447.09014892578125],[192.8776092529297,426.3799743652344],[173.11871337890625,417.2908630371094],[160.94949340820312,402.09710693359375],[152.69857788085938,381.6405029296875],[131.45880126953125,387.6451721191406],[128.26611328125,404.253662109375],[134.62164306640625,426.08148193359375],[140.77279663085938,447.9678039550781],[146.70338439941406,469.9149475097656],[152.40586853027344,491.9223327636719],[157.86395263671875,513.9918212890625],[163.06861877441406,536.1222534179688],[168.00453186035156,558.314208984375],[172.66114807128906,580.56640625],[177.022705078125,602.8782348632812],[181.07662963867188,625.2482299804688],[184.80882263183594,647.6738891601562],[188.2049102783203,670.15283203125],[191.25030517578125,692.68212890625],[193.9305419921875,715.2577514648438],[196.23060607910156,737.8751220703125],[198.13540649414062,760.5293579101562],[199.629638671875,783.21435546875],[200.69801330566406,805.9232177734375],[201.3251953125,828.6485595703125],[201.4952392578125,851.3819580078125],[201.19390869140625,874.1138305664062],[200.4065399169922,896.8342895507812],[199.1189727783203,919.53173828125],[197.31759643554688,942.1941528320312],[194.98960876464844,964.80859375],[192.12254333496094,987.3609619140625],[188.7051239013672,1009.8363647460938],[184.72850036621094,1032.2195434570312],[202.884521484375,1036],[217.2884063720703,1026.4676513671875],[220.31765747070312,1003.9360961914062],[223.26116943359375,981.3931884765625],[226.04820251464844,958.830322265625],[228.59622192382812,936.2393188476562],[230.8342742919922,913.6157836914062],[241.069091796875,900],[263.803466796875,900],[286.537841796875,900],[309.272216796875,900],[332.006591796875,900],[354.740966796875,900],[377.475341796875,900],[400.209716796875,900],[422.944091796875,900],[445.678466796875,900],[468.412841796875,900],[488.1754455566406,903.1422119140625],[489.2020568847656,925.8534545898438],[489.99749755859375,948.573974609375],[490.8268737792969,971.2930908203125],[491.9701232910156,993.998291015625],[492.6429138183594,1016.620361328125],[500.4862365722656,1035.9551391601562],[522.0867614746094,1037.0263671875],[523.8087463378906,1014.3579711914062],[525.0000305175781,991.6551513671875],[525.7506713867188,968.9334716796875],[526.1492004394531,946.202880859375],[526.2801208496094,923.4688720703125],[526.22412109375,900.7345581054688],[526.0657043457031,878.0007934570312],[525.8849792480469,855.2669677734375],[525.7539367675781,832.532958984375],[525.7596435546875,809.7987670898438],[525.9837036132812,787.0656127929688],[546.4244384765625,783.796142578125],[550.1851806640625,762.347412109375],[537.9636840820312,743.717529296875],[543.5552368164062,737.60498046875],[566.1605834960938,739.9291381835938],[568.664794921875,760.8833618164062],[569.3472290039062,783.6073608398438],[569.9760131835938,806.3330078125],[570.5404663085938,829.060546875],[571.0300903320312,851.7894287109375],[571.434326171875,874.5201416015625],[571.74462890625,897.2523803710938],[571.9466552734375,919.9859008789062],[574.1182250976562,942.4239501953125],[573.04833984375,965.1237182617188],[585.9998168945312,980.1273803710938],[582.7029418945312,1002.5982055664062],[582.0922241210938,1025.1692504882812],[599.651611328125,1036.0000610351562],[622.385986328125,1036.0000610351562],[645.120361328125,1036.0000610351562],[667.854736328125,1036.0000610351562],[690.589111328125,1036.0000610351562],[713.323486328125,1036.0000610351562],[736.057861328125,1036.0000610351562],[735.24560546875,1020.874755859375],[717.2114868164062,1007.2530517578125],[696.8837280273438,997.076904296875],[678.0048828125,984.5639038085938],[668.8424072265625,964.4104614257812],[670,941.7700805664062],[670,919.0357055664062],[670,896.3013305664062],[670,873.5669555664062],[670,850.8325805664062],[670,828.0982055664062],[670,805.3638305664062],[669.0402221679688,782.6630859375],[669.59716796875,759.9389038085938],[670.70751953125,737.2314453125],[670.8673095703125,714.5032958984375],[668.3759765625,691.9306030273438],[661.2999877929688,670.3898315429688],[647.4342651367188,652.6889038085938],[627.6043701171875,641.7814331054688],[605.5338134765625,636.49365234375],[582.9039306640625,634.396240234375],[560.1985473632812,633.250244140625],[537.584716796875,631.006591796875],[530.1189270019531,613.3017578125],[515.8188781738281,595.8787231445312],[497.8655090332031,581.9357299804688],[481.1611633300781,566.5697021484375],[463.9173889160156,551.75439453125],[446.5326232910156,537.1043701171875],[429.17083740234375,522.4270935058594],[424.75775146484375,502.0906677246094],[425.82080078125,479.38134765625],[426.4148254394531,456.6556396484375],[426.0644226074219,433.926513671875],[424.2471618652344,411.2707214355469],[420.3438720703125,388.8854064941406],[413.6357727050781,367.18475341796875],[403.4310607910156,346.9060363769531],[389.4023742675781,329.070068359375],[373.9370422363281,313.49615478515625],[374.59027099609375,290.85101318359375],[392.3766784667969,282.064453125],[412.95367431640625,276.09979248046875],[418.27947998046875,254.24465942382812],[422.7541198730469,232.106201171875],[433.7009582519531,611.9910888671875],[430.07080078125,619.9471435546875],[484.0244140625,802.8221435546875],[484.9696960449219,825.5360107421875],[485.96661376953125,848.2484741210938],[486.24786376953125,870.97900390625],[472.29052734375,880],[449.55615234375,880],[426.82177734375,880],[404.08740234375,880],[381.35302734375,880],[358.61865234375,880],[335.88427734375,880],[313.14990234375,880],[290.41552734375,880],[267.68115234375,880],[244.94677734375,880],[232.8994140625,870.2544555664062],[233.9286651611328,847.5459594726562],[234.0673065185547,824.8126220703125],[233.99990844726562,802.078125],[256.65625,802],[279.390625,802],[302.125,802],[324.859375,802],[347.59375,802],[370.328125,802],[393.0625,802],[415.796875,802],[438.53125,802],[461.265625,802],[428,606],[434.6415710449219,620.21630859375],[484,802],[461.23724365234375,802],[438.4745178222656,802],[415.7117919921875,802],[392.94903564453125,802],[370.186279296875,802],[347.4235534667969,802],[324.66082763671875,802],[301.8980712890625,802],[279.13531494140625,802],[256.3725891113281,802],[233.99951171875,802.39013671875],[234.06851196289062,825.1527709960938],[233.92120361328125,847.9144287109375],[232.86912536621094,870.6497802734375],[245.37179565429688,880],[268.134521484375,880],[290.89727783203125,880],[313.6600036621094,880],[336.4227600097656,880],[359.18548583984375,880],[381.9482421875,880],[404.7109680175781,880],[427.47369384765625,880],[450.2364501953125,880],[472.99920654296875,880],[486.2578125,870.2418212890625],[485.9399108886719,847.4834594726562],[484.931396484375,824.7432861328125]]

def process():
    # Final cleanup of the coordinate script
    # NO FRAME: The data provided in Step 223 doesn't have frame points on 20, 808, 1136 edges.
    # SCALING NEEDED: Scale to fit 580x756.
    # 3 PATHS: Split when jumps occur.

    # 1. Determine actual data bounds for precise fit scaling
    xs = [p[0] for p in coords]
    ys = [p[1] for p in coords]
    min_x, max_x = min(xs), max(xs)
    min_y, max_y = min(ys), max(ys)
    
    width = max_x - min_x
    height = max_y - min_y
    
    # Target
    TW, TH = 580, 756
    
    paths = []
    current_path = []
    last_pt = None
    
    for p in coords:
        x_raw, y_raw = p
        
        # Scale proportionally to fit 580x756
        # Map [min_x, max_x] -> [0, 580]
        # Map [min_y, max_y] -> [0, 756]
        nx = int(round((x_raw - min_x) * TW / width))
        ny = int(round((y_raw - min_y) * TH / height))
        
        # Detect jumps > 50 (raw distance)
        if last_pt:
            dist = math.sqrt((x_raw - last_pt[0])**2 + (y_raw - last_pt[1])**2)
            if dist > 50:
                if current_path:
                    paths.append(current_path)
                    current_path = []
        
        current_path.append([nx, ny])
        last_pt = (x_raw, y_raw)
        
    if current_path:
        paths.append(current_path)
        
    # Ensure exactly 3 paths (if more, merge smallest or ignore)
    if len(paths) > 3:
        # Keep top 3 by point count
        paths.sort(key=len, reverse=True)
        paths = paths[:3]
    
    output = {"paths": {}}
    for i, p_list in enumerate(paths):
        output["paths"][f"path_{i+1}"] = p_list
        
    base_dir = "/Users/geofffalk/workspace/mindart_flutter/assets/body_paths/"
    for name in ["man_meditate.json", "woman_meditate.json"]:
        with open(base_dir + name, "w") as f:
            json.dump(output, f, indent=2)
            
    print(f"Processed {len(paths)} paths into {base_dir}")

if __name__ == "__main__":
    process()
